<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <title></title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css" href="css/normalize.css">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="stylesheet" type="text/css" href="css/elements.css">
  <script type="text/javascript" src="js/utils.js"></script>
  <script type="text/javascript" src="js/elements.js"></script>
  <script type="text/javascript" src="js/logging.js"></script>
  <script type="text/javascript" src="js/events.js"></script>
  <script type="text/javascript" src="js/app.js"></script>
  <script type="text/javascript" src="js/ui.js"></script>
</head>
<body>
    <div class="drop-area hide">
        <div class="drop-content">
            <h1>Drop the file here</h1>
        </div>
    </div>

    <div id="welcome" class="modal" data-open="true">
        <div class="modal-content">
            <div class="modal-body">
            <section class="getting-started">
                <h1 class="center">Welcome</h1>
                <p class="center">Click <kbd>Ctrl+V</kbd> to paste an image from the clipboard</p>
                <p class="center">or drag an image to the browser</p>
                <p class="center">or choose an image from your computer</p>
                <div class="center">
                    <input id="imageInput" class="center" type="file" accept="image/*">
                </div>
            </section>
            <section class="guide">
                <article>
                    <h3>You can... </h3>
                    <p>* load an image from the clipboard and your computer</p>
                    <p>* draw lines, rectangles, ellipses, arrows, text</p>
                    <p>* use a <code>Pen</code> to draw anything else</p>
                    <p>* download a PNG image</p>
                </article>
                <article>
                    <h3>Controls</h3>
                    <p><kbd>Ctrl+V</kbd> to paste an image from the clipboard</p>
                    <p><kbd>Ctrl+C</kbd> to copy an image to the clipboard</p>
                    <p><kbd>Ctrl+S</kbd> to download an image</p>
                    <p><kbd>Ctrl+Z</kbd> to undo an action</p>
                    <p><kbd>Ctrl+Scroll</kbd> to zoom</p>
                    </article>
            </section>
            </div>
        </div>
    </div>

    <div class="toolbar">
        <div class="tools">
            <button id="textBtn" class="btn btn-flat btn-dark flex-stretch">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>
            </button>
            <button id="penBtn" class="btn btn-flat btn-dark flex-stretch">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"2"><polygon points="16 3 21 8 8 21 3 21 3 16 16 3"></polygon></svg>
            </button>
            <button id="lineBtn" class="btn btn-flat btn-dark flex-stretch">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="20" y1="4" x2="4" y2="20"></line></svg>
            </button>
            <button id="rectangleBtn" class="btn btn-flat btn-dark flex-stretch">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
            </button>
            <button id="ellipseBtn" class="btn btn-flat btn-dark flex-stretch">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle></svg>
            </button>
            <button id="arrowBtn" class="btn btn-flat btn-dark flex-stretch">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="20" y1="4" x2="4" y2="20"></line><polyline points="14 20 4 20 4 10"></polyline></svg>
            </button>
            <button id="cropBtn" class="btn btn-flat btn-dark flex-stretch">
                <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><path d="M6.13 1L6 16a2 2 0 0 0 2 2h15"></path><path d="M1 6.13L16 6a2 2 0 0 1 2 2v15"></path></svg>
            </button>
        </div>

        <div class="options">
            <div id="sizeOption" class="dropdown dropdown-dark dropdown-flat flex-stretch hidden" data-dropdown>
                <button class="dropdown-toggle btn btn-flat btn-dark">
                    <input id="sizeOptionInput" type="text" value="10px">
                    <svg class="icon small roundable" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-group">
                        <button class="btn btn-flat btn-dark" onclick="sizeOption.decreaseSize()">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                        <button class="btn btn-flat btn-dark" onclick="sizeOption.increaseSize()">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"  stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <button class="btn btn-flat btn-dark" onclick="sizeOption.setSize(6)">6px</button>
                    <button class="btn btn-flat btn-dark" onclick="sizeOption.setSize(10)">10px</button>
                    <button class="btn btn-flat btn-dark" onclick="sizeOption.setSize(14)">14px</button>
                    <button class="btn btn-flat btn-dark" onclick="sizeOption.setSize(18)">18px</button>
                    <button class="btn btn-flat btn-dark" onclick="sizeOption.setSize(24)">24px</button>
                    <button class="btn btn-flat btn-dark" onclick="sizeOption.setSize(36)">36px</button>
                    <button class="btn btn-flat btn-dark" onclick="sizeOption.setSize(72)">72px</button>
                </div>
            </div>

            <div id="textSizeOption" class="dropdown dropdown-dark dropdown-flat flex-stretch hidden" data-dropdown>
                <button class="dropdown-toggle btn btn-flat btn-dark">
                    <input id="textSizeOptionInput" type="text" value="10px">
                    <svg class="icon small roundable" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-group">
                        <button class="btn btn-flat btn-dark" onclick="textSizeOption.decreaseSize()">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                        <button class="btn btn-flat btn-dark" onclick="textSizeOption.increaseSize()">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"  stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        </button>
                    </div>
                    <button class="btn btn-flat btn-dark" onclick="textSizeOption.setSize(6)">6px</button>
                    <button class="btn btn-flat btn-dark" onclick="textSizeOption.setSize(10)">10px</button>
                    <button class="btn btn-flat btn-dark" onclick="textSizeOption.setSize(14)">10px</button>
                    <button class="btn btn-flat btn-dark" onclick="textSizeOption.setSize(18)">18px</button>
                    <button class="btn btn-flat btn-dark" onclick="textSizeOption.setSize(24)">24px</button>
                    <button class="btn btn-flat btn-dark" onclick="textSizeOption.setSize(36)">36px</button>
                    <button class="btn btn-flat btn-dark" onclick="textSizeOption.setSize(72)">72px</button>
                </div>
            </div>

            <div id="colorOption" class="dropdown dropdown-dark dropdown-flat flex-stretch hidden" data-dropdown>
                <button class="dropdown-toggle btn btn-flat btn-dark">
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-group">
                        <button class="btn btn-flat btn-dark red active" onclick="colorOption.setColor(this, '#ff0000')">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </button>
                        <button class="btn btn-flat btn-dark green" onclick="colorOption.setColor(this, '#00ff00')">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </button>
                        <button class="btn btn-flat btn-dark blue" onclick="colorOption.setColor(this, '#0000ff')">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </button>
                    </div>
                    <div class="dropdown-group">
                        <button class="btn btn-flat btn-dark white" onclick="colorOption.setColor(this, '#ffffff')">
                            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </button>
                        <button class="btn btn-flat btn-dark yellow" onclick="colorOption.setColor(this, '#ffff00')">
                            <svg class="icon yellow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </button>
                        <button class="btn btn-flat btn-dark black" onclick="colorOption.setColor(this, '#000000')">
                            <svg class="icon black" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        </button>
                    </div>
                    <button id="colorPickerButton" class="btn btn-flat btn-dark">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
                        Other
                    </button>
                </div>
            </div>
            <input id="colorPicker" class="hidden" type="color">

        </div>

        <div class="menu">
            <div id="zoomOption" class="dropdown dropdown-dark dropdown-flat flex-stretch" data-dropdown>
                <button class="dropdown-toggle btn btn-flat btn-dark">
                    <input type="text" value="100%">
                    <svg class="icon small roundable" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                </button>
                <div class="dropdown-menu">
                    <input id="zoomSlider" type="range" min="1" max="3" step="0.1" value="1">
                </div>
            </div>

            <button id="saveBtn" class="btn">Download</button>
        </div>
    </div>

    <div class="canvases">
        <div></div>
        <canvas id="imageArea"></canvas>
        <canvas id="drawingArea"></canvas>
        <div></div>
    </div>

    <script type="text/javascript">
        window.addEventListener('load', function() {

            function getDrawingAreaSize() {
                var areasElement = document.getElementsByClassName('canvases')[0];

                return {
                    height: areasElement.scrollHeight,
                    width: areasElement.scrollWidth
                };
            }

            function showSpinner() {
                console.log('SPINNER');
            }

            function hideSpinner() {
                console.log('DONE');
            }



            var app = new App(
                getDrawingAreaSize,
                document.getElementById('imageArea'),
                document.getElementById('drawingArea'),
                document.getElementById('textBtn'),
                document.getElementById('penBtn'),
                document.getElementById('rectangleBtn'),
                document.getElementById('ellipseBtn'),
                document.getElementById('lineBtn'),
                document.getElementById('arrowBtn'),
                document.getElementById('zoomOption'),
                document.getElementById('sizeOption'),
                document.getElementById('textSizeOption')
            );

            app.on('image-loading', showSpinner);
            app.on('image-loaded', hideSpinner);
            app.on('image-not-loaded', hideSpinner);
            app.on('image-saving', showSpinner);
            app.on('image-saved', hideSpinner);

            app.on('image-loaded', function hideWelcomeScreen() {
                var welcomeElement = document.getElementById('welcome');

                welcomeElement.dataset.open = 'false';

                app.off('image-loaded', hideWelcomeScreen);
            });


            var saveBtn = document.getElementById('saveBtn');
            saveBtn.addEventListener('click', app.download.bind(app));

            var fileBtn = document.getElementById('imageInput');
            fileBtn.addEventListener('change', function(e) {
                if (e.target.files.length) {
                    app.loadImageFromFileObj(e.target.files[0]);
                }
            });

            window.addEventListener('resize', function(event) {
                app.zoom();
                app.resizeCanvas();
                app.draw();
            });

            var dropareaHiddingTimerID = null;
            var dragoverLastTimeFired = null;
            document.body.addEventListener('dragover', function(event) {
                dragoverLastTimeFired = new Date();

                if (!dropareaHiddingTimerID) {
                    var droparea = document.getElementsByClassName('drop-area')[0];
                    showElement(droparea, 'hide');

                    dropareaHiddingTimerID = setInterval(function() {
                        console.log('check');
                        var nowTime = new Date();
                        if ((nowTime - dragoverLastTimeFired) < 150) {
                            return
                        }

                        var droparea = document.getElementsByClassName('drop-area')[0];
                        hideElement(droparea, 'hide');

                        clearInterval(dropareaHiddingTimerID);
                    }, 50);
                }

                event.preventDefault();
            });

            document.body.addEventListener('drop', function(event) {
                for (var index in event.dataTransfer.types) {
                    if (event.dataTransfer.types[index] != 'Files') {
                        continue
                    }

                    var dataItem = event.dataTransfer.items[index];
                    var file = dataItem.getAsFile();

                    if (!file.type.startsWith('image/')) {
                        continue
                    }

                    var fileReader = new FileReader();
                    fileReader.onload = function(event) {
                        app.loadImageFromUrl(event.target.result);
                    }
                    fileReader.readAsDataURL(file);
                    break
                }

                event.preventDefault();
            });

            initializeUI(app);

            window.app = app;
        });
    </script>
</body>
</html>
